# 工作提示（agents.md）

## 项目目标

本仓库用于构建一个基于 LangChain 的模块化多 Agent 智能体系统，核心关注：

* 多 Agent 协作任务拆解与执行
* 自动工具调用（Tool Routing）
* 上下文与结果整合
* 工程级可扩展架构

首期场景为“日常智能助理”，后续可升级至复杂任务系统（状态机、生成树、RAG、知识图谱）。

项目python环境为"/opt/miniconda3/envs/agent/bin/python"，为python3.12

---

## 仓库结构约定

smart_agent/

* config/llm.py
  统一大模型入口配置
* tools/
  所有外部能力封装层

  * web_search.py（HTML 爬虫搜索）
  * weather.py（实时天气）
  * registry.py（统一工具注册）
* agents/
  智能体角色拆分

  * planner.py（任务拆解）
  * executor.py（自动工具调用）
  * analyst.py（结果整合）
* workflow/

  * flow.py（多 Agent 调度编排）
* main.py
  项目启动入口

---

## 系统工作流编排规范（Workflow Orchestration）

### 1. 默认进入规划模式（Plan Mode）

任何非简单任务（≥3 步或涉及系统设计决策）必须首先进入规划阶段：

* 明确目标与约束条件
* 拆解子任务与执行顺序
* 明确每一步验证方式
* 发现偏差立即停止并重新规划

禁止边想边写、强行推进。

---

### 2. 子智能体并行策略（Subagent Strategy）

复杂问题必须充分使用多 Agent：

* 主 Agent 只负责调度与汇总
* 子 Agent 负责：

  * 技术调研
  * 架构设计
  * Bug 定位
  * 可行性验证

原则：

> 一个 Agent 只解决一个明确问题

---

### 3. 自我进化闭环（Self-Improvement Loop）

* 每次修正错误后，将经验写入 `tasks/lessons.md`
* 将错误转化为工程规则
* 会话开始前回顾相关经验
* 目标是持续降低失误率

---

### 4. 完成前强制验证（Verification Before Done）

任何功能完成前必须提供可验证证据：

* 测试结果
* 日志输出
* 示例运行
* 或明确的逻辑正确性证明

禁止“看起来能用”。

---

### 5. 优雅工程原则（Balanced Elegance）

* 非简单修改必须考虑是否存在更简洁设计
* 出现补丁式修复视为设计失败信号
* 简单问题禁止过度架构

---

### 6. 自动化 Bug 修复模式

当出现错误时：

* 主动查看异常、日志、失败测试
* 定位根因并直接修复
* 不依赖用户补充上下文
* 保证修复通过验证

---

## 强制执行协议（Execution Protocol）

所有非简单任务必须严格按以下阶段执行：

### Phase 1 — 规划

必须输出结构化方案：

* 目标
* 前提假设
* 子任务清单（可勾选）
* 风险与应对
* 验证策略

未完成规划不得进入实现。

---

### Phase 2 — 多 Agent 并行（可选）

针对复杂问题：

* 分配子 Agent 进行调研、设计、调试
* 汇总结果后再实施

---

### Phase 3 — 实现

* 严格按规划执行
* 改动保持最小化
* 禁止范围外扩展

---

### Phase 4 — 验证

至少包含一种：

* 自动测试
* 日志验证
* 示例运行
* 逻辑证明

若验证不足必须回退到规划阶段。

---

### Phase 5 — 复盘

明确说明：

* 修改内容
* 生效原因
* 潜在风险

---

### Phase 6 — 经验沉淀

出现任何修正：

* 写入 `tasks/lessons.md`

---

## 工具系统规范

* 所有工具必须在 `tools/registry.py` 中统一注册
* 工具描述必须语义清晰，便于 LLM 决策
* 严禁在 Agent 内部硬编码调用逻辑

---

## Agent 职责边界

* Planner：只负责任务拆解与计划生成
* Executor：只负责工具调用与执行
* Analyst：只负责结果解释、融合与反馈

禁止职责混用。

---

## Workflow 编排原则

`workflow/flow.py` 只负责：

* Agent 调度
* 执行顺序控制
* 状态传递

不得包含业务推理逻辑。

---

## 技术约束

* 使用 LangChain Agent 原生 tool calling
* 模块必须低耦合、可替换

---

## Coding Style & Engineering Conventions

* Python 3.10+
* 4 空格缩进
* 模块命名使用小写下划线
* 工具函数必须具备 docstring
* 禁止硬编码路径与环境变量
* 禁止所有冗余代码，如不必要的try except.

---

## 核心设计原则

* 所有能力可组合
* 所有状态可外部化
* 所有 Agent 可替换、可并行

---

## 架构预留演进方向

* 并行多 Agent 执行
* 状态机控制流
* 失败回退机制
* 长短期记忆系统
* RAG + 知识图谱
* 推理树与路径搜索

---

## 沟通与输出规范

* 全部使用简体中文
* 提供工程级可运行方案
* 明确模块职责与扩展点
* 避免示例级 toy code

---

本仓库目标是逐步演进为可支撑复杂多步智能任务的通用 Agent 框架，而非一次性脚本工具。
